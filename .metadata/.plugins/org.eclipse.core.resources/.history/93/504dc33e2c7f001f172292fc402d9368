package DiamondShop.Controller.User;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import DiamondShop.Dto.PaginatesDto;
import DiamondShop.Service.User.CategoryServiceImpl;
import DiamondShop.Service.User.PaginatesServiceImpl;

@Controller
public class CategoryController extends BaseController {
    @Autowired
    private CategoryServiceImpl categoryServiceImpl;

    @Autowired
    private PaginatesServiceImpl paginatesServiceImpl;

    private int totalProductsPage = 9; // Số sản phẩm trên mỗi trang

    // Xử lý hiển thị danh mục sản phẩm với phân trang
    @RequestMapping(value = "/san-pham")
    public ModelAndView showProducts(@RequestParam(value = "page", required = false, defaultValue = "1") int currentPage) {
        _mvShare.setViewName("user/products/category");

        // Sử dụng một id danh mục mặc định, ví dụ id = 1
        String defaultCategoryId = "1";
        int totalData = categoryServiceImpl.GetAllProductsByID(Integer.parseInt(defaultCategoryId)).size();
        
        // Lấy thông tin phân trang dựa trên tổng số sản phẩm
        PaginatesDto paginatesInfo = paginatesServiceImpl.GetInfoPaginates(totalData, totalProductsPage, currentPage);

        // Thêm thông tin vào ModelAndView để hiển thị
        _mvShare.addObject("idCategory", defaultCategoryId);
        _mvShare.addObject("paginatesInfo", paginatesInfo);
        _mvShare.addObject("productsPaginate", categoryServiceImpl.GetDataProductsPaginate(Integer.parseInt(defaultCategoryId), paginatesInfo.getStart(), totalProductsPage));
        
        return _mvShare;
    }
}
